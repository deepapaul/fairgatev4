
{% extends app.request.xmlHttpRequest ? '::ajax-layout.html.twig' : '::clubadmin/layout.html.twig' %}
{% set pageTitle = 'TITLE_BOOKMARK'|trans %}

{% block pagecontent %}
    <!-- BEGIN PAGE CONTENT-->
    <div class="row" id="bookmark_form">
        <div class="col-md-12">
            <!-- BREADCRUMB STARTS -->
            {% include 'clubadmin/breadcrumb.html.twig' with {'breadCrumb':{'back': path('clubadmin_sponsor_homepage') }} %}
            <!-- BREADCRUMB ENDS -->
            {#<div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="page-title fg-inner-title">{{pageTitle}}</h3>
                        </div>

                    </div>
                </div>
            </div> #}
            <div class="row">
            {% set page_settings = { 'pagetitle':'true'}  %}
            {% include 'clubadmin/page-title-bar.html.twig' with {'pageTitle': pageTitle , 'page_settings': page_settings  } %}    
           </div>
            <!-- BEGIN FORM-->
            <form id="form" class="form-horizontal fg-bookmark-sponsor-wrap"  novalidate="novalidate" onSubmit="return false;" autocomplete="off">            
                <div class="row fg-border-line fairdragg fg-connan-br-btm fg-sort-drag-hover">   
                    <div class="fg-col-first-icon fg-sort-drag"><i class="fa fg-sort ui-draggable inactive"></i></div>                                        
                    <!-- LISTING FOR ACTIVE CONTACT STARTS-->
                    <div class="col-md-12 fg-col-hack">
                        <div class="row">
                            <div class="col-sm-6 col-xs-12 fg-clear-left fg-bookmark-active-contact">
                                <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left fg-invisible "><label for="box"><i class="fa fa-bookmark"></i></label></div>
                                        
                                <label class="input-sm fg-input-area">{%trans%}ALL_SPONSORS{%endtrans%}</label>                              
                            </div>
                            <div class="col-sm-4  fg-padding-tp-three"> 
                                <a onclick ="javascript:countClick(this);" catid="" service_id="allActive" type="allActive"  href="#"> {{allSponsors}} {{'SPONSORS'|trans}}</a>

                            </div>  
                        </div>






                    </div>
                </div>

                <div class="row fg-border-line fairdragg fg-connan-br-btm fg-sort-drag-hover">   
                    <div class="fg-col-first-icon fg-sort-drag"><i class="fa fg-sort ui-draggable inactive"></i></div>                                        
                    <!-- LISTING FOR ACTIVE CONTACT STARTS-->
                    <div class="col-md-12 fg-col-hack">
                        <div class="row">
                            <div class="col-sm-6 col-xs-12 fg-clear-left"> 
                                <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left fg-invisible "><label for="box"><i class="fa fa-bookmark"></i></label></div>
                                       
                                <label class="input-sm fg-input-area">{{translateArray['active_assignments']}}</label>                              
                            </div>
                            <div class="col-sm-4 fg-padding-tp-three"> 
                                <a onclick ="javascript:countClick(this);" catid="" service_id="overview" bookmarkType='active_assignments' type="overview"  href="#"> {{assignmentsCount['active_assignments']['sidebarCount']}} {% if(assignmentsCount['active_assignments']['sidebarCount']) %} {{'SPONSORS'|trans}} {% else %} {{'SPONSOR_LOWERCASE'|trans}}{%endif%}</a>

                            </div>  
                        </div>
                    </div>
                </div>        
                <div class="row fg-border-line fairdragg fg-connan-br-btm fg-sort-drag-hover">   
                    <div class="fg-col-first-icon fg-sort-drag"><i class="fa fg-sort ui-draggable inactive"></i></div>                                        
                    <!-- LISTING FOR ACTIVE CONTACT STARTS-->
                    <div class="col-md-12 fg-col-hack">
                        <div class="row">
                            <div class="col-sm-6 col-xs-12 fg-clear-left"> 
                                <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left fg-invisible "><label for="box"><i class="fa fa-bookmark"></i></label></div>
                                        
                                <label class="input-sm fg-input-area">{{translateArray['future_assignments']}}</label>                              
                            </div>
                            <div class="col-sm-4 fg-padding-tp-three"> 
                                <a onclick ="javascript:countClick(this);" catid="" service_id="overview" bookmarkType='future_assignments' type="overview"  href="#"> {{assignmentsCount['future_assignments']['sidebarCount']}} {% if(assignmentsCount['future_assignments']['sidebarCount']) %} {{'SPONSORS'|trans}} {% else %} {{'SPONSOR_LOWERCASE'|trans}}{%endif%}</a>

                            </div>  
                        </div>
                    </div>
                </div>  
                <div class="row fg-border-line fairdragg fg-connan-br-btm fg-sort-drag-hover">   
                    <div class="fg-col-first-icon fg-sort-drag"><i class="fa fg-sort ui-draggable inactive"></i></div>                                        
                    <!-- LISTING FOR ACTIVE CONTACT STARTS-->
                    <div class="col-md-12 fg-col-hack">
                        <div class="row">
                            <div class="col-sm-6 col-xs-12 fg-clear-left"> 
                                <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left fg-invisible "><label for="box"><i class="fa fa-bookmark"></i></label></div>
                                       
                                <label class="input-sm fg-input-area">{{translateArray['recently_ended']}}</label>                              
                            </div>
                            <div class="col-sm-4 fg-padding-tp-three"> 
                                <a onclick ="javascript:countClick(this);" catid="" service_id="overview" bookmarkType='recently_ended' type="overview"  href="#"> {{assignmentsCount['recently_ended']['sidebarCount']}} {% if(assignmentsCount['recently_ended']['sidebarCount']) %} {{'SPONSORS'|trans}} {% else %} {{'SPONSOR_LOWERCASE'|trans}}{%endif%}</a>

                            </div>  
                        </div>
                    </div>
                </div>
                <div class="row fg-border-line fairdragg fg-connan-br-btm fg-sort-drag-hover fg-last-item">   
                    <div class="fg-col-first-icon fg-sort-drag"><i class="fa fg-sort ui-draggable inactive"></i></div>                                        
                    <!-- LISTING FOR ACTIVE CONTACT STARTS-->
                    <div class="col-md-12 fg-col-hack">
                        <div class="row">
                            <div class="col-sm-6 col-xs-12 fg-clear-left"> 
                                <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left fg-invisible "><label for="box"><i class="fa fa-bookmark"></i></label></div>
                                        
                                <label class="input-sm fg-input-area">{{translateArray['former_assignments']}}</label>                              
                            </div>
                            <div class="col-sm-4 fg-padding-tp-three"> 
                                <a onclick ="javascript:countClick(this);" catid="" service_id="overview" bookmarkType='former_assignments' type="overview"  href="#"> {{assignmentsCount['former_assignments']['sidebarCount']}} {% if(assignmentsCount['former_assignments']['sidebarCount']) %} {{'SPONSORS'|trans}} {% else %} {{'SPONSOR_LOWERCASE'|trans}}{%endif%}</a>

                            </div>  
                        </div>
                    </div>
                </div>




                <!-- LISTING FOR ACTIVE CONTACT ENDS -->                    
                <div id="bookmarklist_sort" class="excludejs">
                    <!-- LISTING FOR ACTIVE CONTACT ENDS-->
                    <!--  STARTS LISTING FOR OTHER BOOKMARKS, IF EXIST-->
                    {% set i=1 %}
                    {% set bookmark_details_length = bookmark_details|length %}
                    {#% set bookmark_Type=''%}
                    {% set cat_Id=''%}
                    {% set role_Id=''%}
                    {% set j=0%#}
                    {% for key,attributes in bookmark_details %}

                        <div class="row fg-border-line fairdragg sortables fg-sort-drag-hover {%if i == bookmark_details_length %}fg-last-item {% endif %}" id="{{attributes.id}}">
                            <div class="fg-col-first-icon fg-sort-drag">
                                <i class="fa fg-sort ui-draggable handle"></i>                               
                            </div>
                            <div class="col-md-12 fg-col-hack">
                                <div class="row" id="{{attributes.id}}">
                                    <div class="col-sm-6 col-xs-12 fg-clear-left"> 
                                        <div class="bookmark fg-bkmrk-ico-new fg-bkmrk-left"><input id="box{{i}}" type="checkbox" checked class="make-switch" data-key="{{attributes.id}}.is_deleted" name="{{attributes.id}}_is_deleted" id="{{attributes.id}}_is_deleted" />  <label for="box{{i}}"><i class="fa fa-bookmark"></i></label></div>
                                        <label class="input-sm fg-input-area">{{translateArray[attributes.type]|default(attributes.title)}}
                                        </label>
                                    </div>

                                    <div class="col-sm-6 fg-padding-tp-three"> <a href="#">    {#% include 'clubadmin/common.html.twig' with {'type':'totalCount', 'tCount': attributes.count,'id':attributes.bookMarkIds,'filterid':attributes.filterId,'categoryId':cat_Id,'roleId':role_Id,'book_type':bookmark_Type,'contactId':contactId}%#}  </a> </div> 
                                    {% set attributeCount = attributes.count|default(0) %}
                                    {% if (attributes.filterId != '') %}
                                        <div class="col-sm-4 fg-padding-tp-three"> <a onclick ="javascript:filterCountClick(this);" data-filterId="{{attributes.filterId}}" data-status="calculate" href="#"> {{'CALCULATE_CONTACTS'|trans}} </a> </div>   
                                        <input type="hidden" name="{{attributes.filterId}}_jsonData" id="{{attributes.filterId}}_jsonData" value="{{attributes.filterData}}" />
                                    {% else %}
                                        <div class="col-sm-4 fg-padding-tp-three"> <a onclick ="javascript:countClick(this);" catid="{{attributes.catId}}" service_id="{{attributes.subcatId}}" type="{{attributes.type}}" service_type="{{attributes.sType}}" href="#">   {{attributeCount}} {% if(attributeCount) %} {{'SPONSORS'|trans}} {% else %} {{'SPONSOR_LOWERCASE'|trans}} {% endif%} {#% include 'clubadmin/common.html.twig' with {'type':'docCount', 'tCount':attributes.count,'docType':docType ,'contactId':contactId,'catClubId':attributes.subCatClubId, 'catId':attributes.catId,'subcatId':attributes.subcatId,'clubId':clubId}%#}  </a> </div>   
                                    {% endif %}
                                    <input type="hidden" class="sorthidden" data-key="{{attributes.id}}.sort_order" name="{{attributes.id}}_sort_order" id="{{attributes.id}}_sort_order" value="{{i}}" data-sort-parent="bookmarklist_sort" />
                                </div>
                            </div>
                        </div>

                        {% set i=i+1 %}
                    {% endfor %}
                </div>
                <!--  ENDs LISTING FOR OTHER BOOKMARKS, IF EXIST-->
                <!--  Partial twig for savebutton-->          
                {% include 'clubadmin/savebutton.html.twig'  with {'backLink':backlink} %}            

            </form>
            <!-- END FORM-->
        </div>
    </div>


    <!-- END PAGE CONTENT-->
{% endblock %}
{% block javascripts %}
    <script type="text/javascript">
        var contactid = '{{contactId}}';
        var clubid = '{{clubId}}';
        var initialOrderArray = new Array();
        $(document).ready(function () {
            initialOrderArray = FgUtility.getOrderOfChildElements('#bookmarklist_sort');
            FgDirtyForm.init();
            FgDirtyForm.disableButtons();
            FgDragAndDrop.sortWithOrderUpdation('#bookmarklist_sort', false);
            var resetSections = {
                '0': {
                    'parentElement': '#bookmarklist_sort',
                    'initialOrder': initialOrderArray,
                    'addClass': false,
                    'className': 'blkareadiv'
                }
            };
            FgResetChanges.init(resetSections);
        });

        $('form').on('click', '#save_changes', function () {
            var objectGraph = {};
            $("form :input").each(function () {
                if ($(this).hasClass("fairgatedirty")) {
                    var inputVal = ''
                    if ($(this).attr('type') == 'checkbox') {
                        inputVal = $(this).attr('checked') ? 0 : 1;
                    } else {
                        inputVal = $(this).val();
                    }

                    if (inputVal !== '') {
                        converttojson(objectGraph, $(this).attr('data-key').split('.'), inputVal);
                    }
                }
            });

            var bookmarkArr = JSON.stringify(objectGraph);
            FgXmlHttp.post("{{ path('sponsor_bookmark_update')}}", {'bookmarkArr': bookmarkArr}, false, callbackfn);
        });

        function callbackfn() {
            FgApp.init();
            FgDragAndDrop.sortWithOrderUpdation('#bookmarklist_sort', false);
        }
        function countClick(_this) {
            FgSponsor.handlesidebarclick(_this, '{{path('clubadmin_sponsor_homepage')}}', contactid, clubid, 'bookmark');
        }
        
        function filterCountClick(_this)
        {
            var filterId = $(_this).attr('data-filterId');
            var status = $(_this).attr('data-status');
            if (status == 'calculate') {
                var url = "{{ path('update_sponsor_filter_count')}}";
                $(_this).attr('data-status', 'sponsorfilter');
                $.post(url, {filterId: filterId}, function(data) { 
                    if (data == '-1') {
                        $(_this).html('<i class="fa fa-warning fg-warning"></i>'); 
                    } else if (data == 1) {
                        $(_this).html(data + ' ' + '{{'CONTACT'|trans}}');
                    } else {
                        $(_this).html(data + ' ' + '{{'contacts'|trans}}');  
                    }
                });
                return false;
            } else {
                handleCountOrSidebarClick.updateFilter('FILTER', 'filterdisplayflag_contact'+clubid+'-'+contactid, '', clubid, contactid, '', '', '{{fgclub.clubUrlIdentifier}}', 'count', '', '', '', '', 'sponsor', '', $('#'+filterId+'_jsonData').val(), filterId, '');
            }
        }
        /*-------------- Page title bar configuration --------*/ 
            FgPageTitlebar.init({
                     title: true
             }); 
    </script>
    <script src="{{ asset('fgcustom/js/sidebarfilter.js')}}" type="text/javascript"></script> 
    <script src="{{ asset('fgcustom/js/sidebar.js')}}" type="text/javascript"></script> 
{% endblock %}